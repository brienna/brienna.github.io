<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />


	<title>Don't block the GUI: Dealing with long-running tasks using a SwingWorker · briennakh</title>


<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@briennakh" />
<meta name="twitter:title" content="Don't block the GUI: Dealing with long-running tasks using a SwingWorker" />
<meta name="twitter:description" content="Swing is not thread-safe. Because of this, you can update the GUI from only the event dispatch thread, and not any other thread, otherwise unwanted behavior may result. If you can update the GUI fr...">

<meta name="description" content="Swing is not thread-safe. Because of this, you can update the GUI from only the event dispatch thread, and not any other thread, otherwise unwanted behavior ...">


	<meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o">


<link rel="icon" href="/assets/favicon.png">
<link rel="apple-touch-icon" href="/assets/touch-icon.png">
<link rel="stylesheet" href="/assets/core.css">
<link rel="canonical" href="/notes/swingworker">
<link rel="alternate" type="application/atom+xml" title="briennakh" href="/feed.xml" />




<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


	</head>

	<body>

		<aside class="logo">

	

	<a href="/">
		<img src="http://www.gravatar.com/avatar/a1874522e5d9bff764e068c928f0e3c0.png?s=80" class="gravatar">
	</a>
	<span class="logo-prompt">Back to Home</span>

</aside>


		<main>
			<article>

	<div class="center">
		<h1>Don't block the GUI: Dealing with long-running tasks using a SwingWorker</h1>
		<time>July 13, 2017</time>
	</div>

	<div class="divider"></div>

	<p>Swing is not thread-safe. Because of this, you can update the GUI from only the event dispatch thread, and not any other thread, otherwise unwanted behavior may result. If you can update the GUI from only the event dispatch thread, how do you handle long-running tasks that may lock up this thread, freezing the GUI?</p>

<p>This post explains how, using a simple counter GUI for demonstration purposes.</p>

<h3 id="types-of-threads-in-swing">Types of threads in Swing</h3>

<p>There are three types of threads in Swing:</p>

<ul>
  <li><strong>initial thread</strong> — where the program starts.</li>
  <li><strong>event dispatch thread</strong> — where all the code that interacts with the GUI is executed.</li>
  <li><strong>worker thread (background thread)</strong> — where long-running tasks are executed.</li>
</ul>

<p>You don’t need to explicitly create these threads; they are provided by the runtime or the Swing framework. You just utilize these threads to create a responsive, maintainable Swing program.</p>

<h3 id="a-swing-program-runs-on-the-event-dispatch-thread">A Swing program runs on the event dispatch thread</h3>

<p>Like other standard Java programs, a Swing program starts on the initial thread. The initial thread could simply create the GUI itself, but this isn’t recommended. For a Swing program, the initial thread’s recommended job is to “create a Runnable object that initializes the GUI and schedule that object for execution on the event dispatch thread” <a href="https://docs.oracle.com/javase/tutorial/uiswing/concurrency/initial.html">(Oracle)</a>.</p>

<p>To do this job, invoke <code class="highlighter-rouge">SwingUtilities.invokeLater</code>. Executing on the event dispatch thread, this method asynchronously invokes the Runnable object you pass to it, taking into consideration that the thread may be busy at the time.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">counter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.swing.SwingUtilities</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SwingUtilities</span><span class="o">.</span><span class="na">invokeLater</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">CounterView</span> <span class="n">view</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CounterView</span><span class="o">();</span>
                <span class="n">view</span><span class="o">.</span><span class="na">activate</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="dont-block-the-gui-by-putting-long-running-tasks-on-the-event-dispatch-thread">Don’t block the GUI by putting long-running tasks on the event dispatch thread</h3>

<p>“Once the GUI is created, the program is primarily driven by GUI events, each of which causes the execution of a short task on the event dispatch thread” <a href="https://docs.oracle.com/javase/tutorial/uiswing/concurrency/initial.html">(Oracle)</a>.</p>

<p>All of the tasks that you perform on the event dispatch thread should be instantaneous. Long-running tasks should not happen on this thread.</p>

<p>The following code builds the counter GUI, but the “Start counter” button action listener executes a long-running task <em>on</em> the event dispatch thread.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">counter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.awt.BorderLayout</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.JPanel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.JFrame</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.JButton</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.JLabel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.SwingWorker</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.SwingConstants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CounterView</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">JFrame</span> <span class="n">frame</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">JPanel</span> <span class="n">gui</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">JButton</span> <span class="n">button</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">JLabel</span> <span class="n">count</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CounterView</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">customizeFrame</span><span class="o">();</span>
        <span class="n">createMainPanel</span><span class="o">();</span>
        <span class="n">createCountText</span><span class="o">();</span>
        <span class="n">createButton</span><span class="o">();</span>
        <span class="n">addComponentsToFrame</span><span class="o">();</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">customizeFrame</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JFrame</span><span class="o">();</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">setDefaultCloseOperation</span><span class="o">(</span><span class="n">JFrame</span><span class="o">.</span><span class="na">EXIT_ON_CLOSE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">createMainPanel</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">gui</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JPanel</span><span class="o">();</span>
        <span class="n">gui</span><span class="o">.</span><span class="na">setLayout</span><span class="o">(</span><span class="k">new</span> <span class="n">BorderLayout</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">createCountText</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">count</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JLabel</span><span class="o">(</span><span class="s">"0"</span><span class="o">);</span>
        <span class="n">count</span><span class="o">.</span><span class="na">setHorizontalAlignment</span><span class="o">(</span><span class="n">SwingConstants</span><span class="o">.</span><span class="na">CENTER</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">createButton</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">button</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="o">(</span><span class="s">"Start counter"</span><span class="o">);</span>
        <span class="n">button</span><span class="o">.</span><span class="na">addActionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">ActionListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="cm">/* 
             * This task will freeze the GUI because it is a long-running
             * task happening on the event dispatch thread
             */</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">count</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span> 
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">error</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addComponentsToFrame</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">gui</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">count</span><span class="o">,</span> <span class="n">BorderLayout</span><span class="o">.</span><span class="na">CENTER</span><span class="o">);</span>
        <span class="n">gui</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">button</span><span class="o">,</span> <span class="n">BorderLayout</span><span class="o">.</span><span class="na">SOUTH</span><span class="o">);</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gui</span><span class="o">);</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">pack</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><img src="/assets/07-13-17/frozen_gui.gif" alt="frozen gui" class="center-image" /></p>

<p>As the GIF shows, the GUI has frozen. Because there is a long-running task happening on the event dispatch thread, I am unable to resize the window or do anything with the GUI until the task has completed.</p>

<h3 id="how-to-handle-long-running-tasks">How to handle long-running tasks</h3>

<p>To avoid blocking the GUI, move a long-running task to another thread, the worker thread.</p>

<p>Since you can update the GUI from only the event dispatch thread, you need to faciliate communication between the worker thread and the event dispatch thread. The easiest way to do this in Swing is to use the <code class="highlighter-rouge">javax.swing.SwingWorker</code> class, which runs a task on a worker thread and manages the interthread communication.</p>

<p>In the following code edit, the “Start counter” button action listener creates and executes an instance of <code class="highlighter-rouge">SwingWorker</code> from the event dispatch thread. When the user presses the button, the worker object launches a worker thread and runs the task on it, leaving the event dispatch thread unblocked.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">createButton</span><span class="o">()</span>  <span class="o">{</span>
    <span class="n">button</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="o">(</span><span class="s">"Start counter"</span><span class="o">);</span>
    <span class="n">button</span><span class="o">.</span><span class="na">addActionListener</span><span class="o">(</span><span class="k">new</span> <span class="n">ActionListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="cm">/* 
         * This long-running task doesn't freeze the GUI because it is 
         * happening on a worker thread, not the event dispatch thread
         */</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Create the worker</span>
            <span class="n">SwingWorker</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="n">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SwingWorker</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>

                <span class="nd">@Override</span>
                <span class="kd">protected</span> <span class="n">Void</span> <span class="nf">doInBackground</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="n">count</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                    <span class="o">}</span>

                    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">};</span>

            <span class="n">button</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
            <span class="c1">// Start the worker</span>
            <span class="n">worker</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">button</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> 
        <span class="o">}</span>
    <span class="o">});</span>
<span class="o">}</span>
</code></pre>
</div>

<p><img src="/assets/07-13-17/unfrozen_gui.gif" alt="unfrozen gui" class="center-image" /></p>

<p>As the GIF shows, the GUI does not freeze, because the long-running task has been moved to a worker thread.</p>

<p>Note about <code class="highlighter-rouge">SwingWorker</code>: Each long-running task gets its own <code class="highlighter-rouge">SwingWorker</code> worker, and each worker can be used only once.</p>

<p><em>Note about the GIFs: The GIFs don’t show the button becoming disabled after the click, because this edit occurred after the GIFs’ creation.</em></p>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>If you need to determine whether your code is running on the event dispatch thread, invoke <code class="highlighter-rouge">javax.swing.SwingUtilities.isEventDispatchThread</code>.</p>


    <!--DISQUS-->
    
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
        this.page.url = "http://briennakh.github.io/notes/swingworker";
        this.page.identifier = "/notes/swingworker"; 
        };
        
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://briennakh-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>                          
    

</article>




<div class="page-navigation">
	
    <a class="next" href="/notes/swingworker-mvc-organization" title="NEXT: Where to invoke a SwingWorker in the MVC pattern">&lt;&lt;</a>
		<span> &middot; </span>
  
		<a class="home" href="/" title="Back to Homepage">Home</a>
  
		<span> &middot; </span>
    <a class="prev" href="/notes/calculating-elapsed-time" title="PREV: Measuring execution time">&gt;&gt;</a>
  
</div>

		</main>

		<div class="footer">
  <span class="block">&lt;/&gt; <a href="http://github.com/heiswayi/the-plain" title="a minimalist Jekyll theme for personal blog">The Plain theme</a> by <a href="http://heiswayi.github.io">Heiswayi Nrird</a>.</span>
  <span class="block">&copy; 2017 Brienna Herold</span>
</div>


	</body>

</html>
